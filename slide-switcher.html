<link rel="import" href="bower_components/core-selector/core-selector.html">
<link rel="import" href="slide-clip.html">

<polymer-element name="slide-switcher" attributes="selected selectedIndex valueattr noscroll" on-mousewheel="{{scroll}}">
	<template>
		<style>
			:host {
				bottom: 0;
				position: absolute;
				top: 0;
				width: 100%;
				overflow: hidden;
				-moz-transition: opacity .5s,-moz-transform 1s;
				-o-transition: opacity .5s,-o-transform 1s;
				-webkit-transition: opacity .5s,-webkit-transform 1s;
				transition: opacity .5s,transform 1s;
				-moz-transition-timing-function: cubic-bezier(.77,0,.175,1);
				-o-transition-timing-function: cubic-bezier(.77,0,.175,1);
				-webkit-transition-timing-function: cubic-bezier(.77,0,.175,1);
				transition-timing-function: cubic-bezier(.77,0,.175,1);
				-webkit-backface-visibility: hidden;
				-moz-transform: translate3d(0,0,0);
				-ms-transform: translate3d(0,0,0);
				-o-transform: translate3d(0,0,0);
				-webkit-transform: translate3d(0,0,0);
				transform: translate3d(0,0,0);
				-moz-box-sizing: border-box;
				box-sizing: border-box;
			}
			:host > div {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}
		</style>
		<core-selector id="selector" selected="{{selected}}" selectedIndex="{{selectedIndex}}" valueattr="{{valueattr}}" target="{{$.slides}}" itemSelector="slide-clip"></core-selector>
		<div>
			<content select="slide-clip"></content>
		</div>
	</template>
	<script>
		Polymer('slide-switcher', {
			observe: {
				selectedIndex: 'refresh',
				selected: 'refresh'
			},
			selectedIndex: 0,
			noscroll: false,
			scroll: function(e){
				if(!this.noscroll && (!this.lastScroll || new Date() - this.lastScroll > 1000)){
					this.lastScroll = new Date();
					var scroll = e.wheelDelta ? e.wheelDelta : - e.detail;
					if(scroll < 0 && this.selectedIndex < this.clips.length - 1){
						this.selectedIndex++;
					}else if(scroll > 0 && this.selectedIndex > 0){
						this.selectedIndex--;
						
					}
				}
			},
			refresh: function(){
				var me = this;
				me.clips = this.getElementsByTagName('slide-clip').array();
				me.selected = me.clips[me.selectedIndex][me.valueattr] || me.selectedIndex;
				me.clips.forEach(function(clip, index){
					if(index < me.selectedIndex){
						clip.removeAttribute('show');
						clip.setAttribute('hidden-top', true);
					}else if(index === me.selectedIndex){
						clip.removeAttribute('hidden-top');
						clip.removeAttribute('hidden-bottom');
						clip.setAttribute('show', true);
					}else{
						clip.removeAttribute('show');
						clip.setAttribute('hidden-bottom', true);
					}
				});
			},
			domReady: function(){
				if(/Firefox/i.test(navigator.userAgent)){
					this.addEventListener('DOMMouseScroll', this.scroll);
				}
				this.refresh();
			}
		});
	</script>
</polymer-element>