<link rel="import" href="../core-selector/core-selector.html">
<link rel="import" href="slide-clip.html">

<polymer-element name="slide-switcher" attributes="noscroll" extends="core-selector">
	<template>
		<link href="slide-switcher.css" rel="stylesheet">
		<core-selection id="selection" multi="{{multi}}" on-core-select="{{selectionSelect}}"></core-selection>
		<div>
    		<content id="items" select="slide-clip"></content>
		</div>
	</template>
	<script>
		Polymer('slide-switcher', {
			observe: {
				selectedIndex: 'refresh',
				noscroll: 'setEventHandling'
			},
			setEventHandling: function(){
				var me = this;
				if(me.noscroll){
					me.removeEventListener('mousewheel', me.scroll);
					me.removeEventListener('DOMMouseScroll', me.scroll);
				}else{
					me.addEventListener('mousewheel', me.scroll);
					me.addEventListener('DOMMouseScroll', me.scroll); //Fierefox is weird
				}
			},
			scroll: function(e){
				if(!this.lastScroll || new Date() - this.lastScroll > 1000){
					this.lastScroll = new Date();
					var scroll = e.wheelDelta ? e.wheelDelta : - e.detail;
					if(scroll < 0 && this.selectedIndex < this.items.length - 1){
						this.selectedIndex++;
					}else if(scroll > 0 && this.selectedIndex > 0){
						this.selectedIndex--;
					}
				}
			},
			refresh: function(oldVal, newVal){
				var me = this;
				me.selected = (me.valueattr && me.items[me.selectedIndex]) ? me.valueForNode(me.items[me.selectedIndex]) : me.selectedIndex;
				me.items.forEach(function(clip, index){
					if(index === oldVal || index === newVal){
						clip.removeAttribute('ghost');
					}else{
						clip.setAttribute('ghost', true);
					}
					if(index < me.selectedIndex){
						clip.removeAttribute('show');
						clip.removeAttribute('hidden-bottom');
						clip.setAttribute('hidden-top', true);
					}else if(index === me.selectedIndex){
						clip.removeAttribute('hidden-top');
						clip.removeAttribute('hidden-bottom');
						clip.setAttribute('show', true);
					}else if(index > me.selectedIndex){
						clip.removeAttribute('show');
						clip.removeAttribute('hidden-top');
						clip.setAttribute('hidden-bottom', true);
					}
				});
			},
			domReady: function(){
				this.setEventHandling();
				this.refresh(this.selectedIndex, this.selectedIndex);
			}
		});
	</script>
</polymer-element>
